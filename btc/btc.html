<!DOCTYPE HTML>
<html>
	<head>
		<title>Bitcoin</title>
		<meta charset="utf-8">
		<!--<link rel="icon" href="btcIco.png">-->
		<style type="text/css">
			html {
			    align-items: center;
			    background-color: #ff9500;
			    display: flex;
			    font-family: "Inconsolata", monospace;
			    height: 100%;
			    justify-content: center;
			    font-size: 5vh;
			}

			body {
			    background-color: #393939;
			    color: #ffffff;
			    display: flex;
			    flex-direction: column;
			}
		</style>
		<script type="text/javascript">
			function inizializzaStorage(){
				if (typeof(localStorage.saldoBtcLF)=="undefined") {
					localStorage.saldoBtcLF="";
				}
			}

			function resetStorageUtenti(){
				localStorage.saldoBtcLF="";
				alert("Reset effettuato");
			}

			function stampaStorageSalvato(){
				//alert("Nome: "+localStorage.saldoBtcLF.nome);
				s=new String("<fieldset><legend>Stampa storage</legend>"+localStorage.saldoBtcLF+"</fieldset>");
				document.getElementById("vistaStorage").innerHTML=s;
			}

			function inserisciSoldi(){
				var btc = document.getElementById("campoInput").value;
				localStorage.saldoBtcLF = JSON.stringify(btc)
			}
		</script>
	</head>
	<body onload="inizializzaStorage();">
		<table>
				<td><div style="text-align: center;">1₿ vale</div></td>
				<tr></tr>
				<td><div id="idProva" style="text-align: center;">Caricamento...</div></td>

				<td>
				<input type="button" name="stampaStorage" value="Stampa storage"
						onclick="stampaStorageSalvato();">
			</td>
			<td>
				<input type="button" name="resetStorage" value="Reset storage"
						onclick="resetStorageUtenti();">
			</td>
			<input type="number" id="campoInput" 
			onchange="inserisciSoldi();">
		</table>

		<div id="vistaStorage">
			<!--
			<fieldset>
				<legend>Stampa storage</legend>
			</fieldset>
			-->
		</div>

		<script>
			var xhr = new XMLHttpRequest();
			xhr.open('GET', 'https://api.coinbase.com/v2/prices/spot?currency=EUR', true);
			xhr.onload = function () {
				if (xhr.readyState === xhr.DONE) {
					if (xhr.status === 200) {
						var datiResponse=xhr.responseText;
						console.log("Dati richiesti: "+datiResponse);
						var datiResponseJSON = JSON.parse(datiResponse);
						var drj = datiResponseJSON["data"]["amount"]
						document.getElementById("idProva").innerHTML = drj+"€";
						console.log("drj ora: "+drj);
					}
				}
			};
			xhr.send(null);
		</script>
	</body>
</html>